{
  "variables": {
    "gcp_project_id": "",
    "version_suffix": ""
  },
  "builders": [
    {
      "type": "googlecompute",
      "project_id": "{{user `gcp_project_id`}}",
      "source_image_family": "debian-11",
      "machine_type": "e2-medium",
      "ssh_username": "packer",
      "image_name": "kali-xfce4-{{user `version_suffix`}}",
      "zone": "europe-west1-d",
      "disk_size": 50,
      "disk_type": "pd-ssd",
      "disable_default_service_account": true,
      "metadata": {
        "enable-oslogin": "false"
      },
      "network": "packer",
      "subnetwork": "private",
      "use_internal_ip": true,
      "omit_external_ip": true,
      "use_iap": true,
      "preemptible": true
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "script": "//flavours/debian:_chrome-remote-desktop",
      "execute_command": "echo 'packer' | sudo -S sh -c '{{ .Vars }} {{ .Path }}'"
    },
    {
      "type": "shell",
      "script": ":_debian-to-kali",
      "execute_command": "echo 'packer' | sudo -S sh -c '{{ .Vars }} {{ .Path }}'"
    }
  ],
  "post-processors": [
    {
      "type": "manifest"
    }
  ]
}
